README for LB_SYS_PL_v*.*
       Written by T. Matsumura

Version history
2016-8-27: LB_SYSPL_v4.2
2014-10-2: LB_SYSPL_ver3.2
2013-12-25: LB_SYSPL_beta0.1
2013-12-20: LB_SYSPL_beta0.0

--------------------------------------------------------------------------------------------
Assumptions: 
	   - We assume you will be using this set of codes in kekcc.
	   - Accessible to the standard python tools, including python, numpy, pylab, scipy, healpy, ...
	   - For more details, check http://wiki.kek.jp/display/litebird/LB-SYSPL+README, 
	           or github wiki at https://github.com/tmatsumu/LB_SYSPL_v4.2/wiki
--------------------------------------------------------------------------------------------

What this software does is followings

1. read boresight pointing (generated by pyScan)
2. generate the TOD on the fly (you have an option to write to a disk) given the boresight pointing and the focal plane information
3. execute simple mapmaking and generate the maps per day (optionally per pixel)
4. execute coadd the maps from all the days and generate the X days combined map
5. compute the power spectrum using anafast from the map generated above 
6. plot the Cls

--------------------------------------------------------------------------------------------

Install

1) You need python2.7 and the following libraries and python modules
   - python 2.7
   - setuptools
   - Cython
   - numpy
   - lapack
   - atlas
   - scipy
   - pyfits-3.3
   - pyslalib
   - matplotlib-1.5.3
   - healpy
   - pyephem
   - cfitsio
   - Healpix3.31

2) set up the directory structure
   > cd LB_SYSPL_v4.2
   > cd Simulator
   > ./init.sh help
   and follow the instructions

   open init.sh and modify followings
   example) for user, tmatsumu, 
	dir_simulator==$HOME/LB_SYSPL/LB_SYSPL_v4.2/Simulator/
	dir_proj=/group/cmb/litebird/usr/tmatsumu/LB_SYSPL_v4.2/
   dir_simulator is where the simulator directory is in your account.
   dir_proj is where the data(boresight pointing, tod if generated, output maps, fpdb, input maps, e.t.c.) are stored.   

   then 
   > ./init.sh mkdir
   > ./init.sh cp_db
   > ./init.sh gen_global_par
 
--------------------------------------------------------------------------------------------

In order to run, you need to do the followings

1) go to 
   > cd /group/cmb/litebird/usr/tmatsumu/LB_SYSPL_v4.2/Simulator/gen_run
   
   - define what you want to do in par_example_LB_SYSPL.py (how to modify is in wiki)
   - modify run_example_LB_SYSPL.sh (two parametesr to change: how many detectors to run and how many days to run)
   - onces it's ready to run
   > ./run_example.sh init
   > ./run_example.sh mm

2) if you execute successfully, 
   check the status of the batch job
   > bjobs
   1 job contains 1 day of tod simulation.

3) once the job is done successfully,
   > ./run_example.sh coadd
   > bjobs
   This job should complete within a min

4) Once the above job is done succeslly,
   go to 
   > cd /group/cmb/litebird/usr/tmatsumu/LB_SYSPL_v4.2/data_proj/
   > cd SimedMaps/RunLog/example_LB_SYSPL
   > ls
   > cd png
   > display mapT.png &

5) delete the used input package that take a large file size
   > ./run_example.sh clean_npy
   > ./run_example.sh clean_npz
   > ./run_example.sh clean_tod (if tod is generated)

6) generate Cl fits using anafast 
   > ./run_example.sh anafast

7) plot fits to png
   > ./run_example.sh plot_anafast 0
   the last 0 is the beam size in arcmin to deconvolve
   
   For more questions, check http://wiki.kek.jp/display/litebird/LB-SYSPL+README, https://github.com/tmatsumu/LB_SYSPL_v4.2/wiki
   or contact to tmatsumu_AT_astro.isas.jaxa.jp
